[workspace]
authors = ["Evgenii Tretiakov <Evgenii.Tretiakov@meduniwien.ac.at>"]
channels = ["conda-forge", "bioconda"]
name = "cytonaut"
description = "Single-cell omics survival guide for Molecular Neuroscience PhD students"
platforms = ["linux-64", "osx-64", "osx-arm64", "win-64"]
version = "0.1.0"

# ── Cross-platform tasks (deno_task_shell abstracts OS differences) ──────────
[tasks]
# Start interactive R session via radian (modern R console with syntax highlighting)
start = "radian"

# Render all seminar notebooks to HTML
render = "quarto render"

# Render first seminar only
render-seminar01 = "quarto render notebooks/01-seminar-single-cell-fundamentals.qmd --to html"

# Preview with live reload (great for iterative writing)
preview = "quarto preview"

# Setup chain: install BiocManager, then Bioconductor pkgs, then GitHub pkgs
setup-environment = { depends-on = ["configure", "bioconductor-install", "github-install"] }

# Step 1: Configure BiocManager
configure = { cmd = [
  "Rscript", "-e",
  "BiocManager::install(version = '3.21', dependencies = TRUE, upgrade_dependencies = TRUE, ask = FALSE)"
] }

# Step 2: Install Bioconductor packages not available on conda-forge
bioconductor-install = { cmd = [
  "Rscript", "-e",
  "BiocManager::install(c('AnnotationDbi', 'BiocGenerics', 'IRanges', 'S4Vectors', 'MatrixGenerics', 'gprofiler2', 'UCSC.utils', 'SummarizedExperiment', 'SingleCellExperiment', 'org.Mm.eg.db', 'org.Hs.eg.db', 'EnsDb.Mmusculus.v79', 'EnsDb.Hsapiens.v86', 'scater', 'scran', 'scuttle', 'glmGamPoi', 'DESeq2', 'ensembldb'), dependencies = TRUE, ask = FALSE)"
], depends-on = ["configure"] }

# Step 3: Install packages from GitHub (latest dev versions)
github-install = { cmd = [
  "Rscript", "-e",
  "remotes::install_github(c('satijalab/seurat', 'satijalab/seurat-data', 'satijalab/seurat-wrappers', 'samuel-marsh/scCustomize', 'sjessa/ggmin', 'thomasp85/patchwork', 'satijalab/azimuth'), dependencies = TRUE, upgrade = 'never')"
], depends-on = ["bioconductor-install"] }

# ── Platform-specific IDE launchers ──────────────────────────────────────────
[target.linux-64.tasks]
rstudio = "rstudio"

# On macOS, both Intel and Apple Silicon use `open -a`
[target.osx.tasks]
rstudio = "open -a RStudio"

# On Windows, launch RStudio from default install path or PATH
[target.win-64.tasks]
rstudio = "rstudio"

# ── Dependencies (all from conda-forge/bioconda, cross-platform) ─────────────
[dependencies]
# --- R core ---
r-base = ">=4.4.2,<4.5"
r-biocmanager = ">=1.30.25,<2"
r-remotes = ">=2.5.0,<3"

# --- Interactive R console ---
radian = ">=0.6.15,<0.7"

# --- IDE support (VS Code / Positron) ---
r-languageserver = ">=0.3.16,<0.4"
r-httpgd = ">=2.0.4,<3"

# --- Quarto for reproducible manuscripts ---
quarto = ">=1.6.40,<2"

# --- Tidyverse ecosystem ---
r-tidyverse = ">=2.0.0,<3"
r-magrittr = ">=2.0.3,<3"
r-janitor = ">=2.2.1,<3"
r-skimr = ">=2.2.1,<3"
r-here = ">=1.0.1,<2"

# --- Single-cell analysis ---
r-seurat = ">=5.3.0,<6"
r-seuratobject = ">=5.1.0,<6"
r-leidenbase = ">=0.1.32,<0.2"
r-rcpphnsw = ">=0.6.0,<0.7"
r-hdf5r = ">=1.3.12,<2"

# --- Visualization ---
r-ggplot2 = ">=3.5.2,<4"
r-cowplot = ">=1.2.0,<2"
r-patchwork = ">=1.3.0,<2"
r-ggnewscale = ">=0.5.0,<0.6"
r-ggrepel = ">=0.9.6,<0.10"
r-ggrastr = ">=1.0.2,<2"
r-ggstatsplot = ">=0.13.0,<0.14"
r-rcolorbrewer = ">=1.1_3,<2"
r-viridis = ">=0.6.5,<0.7"
r-upsetr = ">=1.4.0,<2"

# --- Computation and parallelism ---
r-future = ">=1.34.0,<2"
r-matrixstats = ">=1.4.0,<2"

# --- Reporting and reproducibility ---
r-knitr = ">=1.49,<2"
r-rmarkdown = ">=2.29,<3"
r-sessioninfo = ">=1.2.3,<2"

# --- Python interop (for CellBender, scvi-tools, scrublet) ---
r-reticulate = ">=1.40.0,<2"
python = ">=3.12,<3.13"

# --- System libraries ---
zlib = ">=1.3.1,<2"
liblzma = ">=5.6,<6"
liblzma-devel = ">=5.6,<6"
